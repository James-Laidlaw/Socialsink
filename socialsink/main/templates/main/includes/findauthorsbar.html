<div id="find-author-bar" style="overflow: hidden;">
    <h4 class="heading">Who to follow</h4>
    <div class="author-box"></div>
</div>

<script>
    const authorBox = document.querySelector('.author-box')

    function createAuthorPanel(username, id) {
        const authorElem = document.createElement('div');
        authorElem.classList.add('author');

        authorElem.innerHTML = `<a href="/"><img src="../../../static/images/unknown_user.png" /></a>
                                <div class="author-content">
                                    <div>
                                        <p class="author-username">${username}</p>
                                    </div>
                                    <button class="btn" onClick="followAuthor(event, '${id}')">Follow</button>
                                </div>`;
        return authorElem;
    }

    function followAuthor(e, id) {
        e.preventDefault();
        var csrf_token = "{{ csrf_token }}";
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrf_token);
                }
            }
        });
        $.ajax({
            type: "POST",
            url: "/api/follow/",
            contentType: 'application/json',
            data: JSON.stringify({
                'id': id
            }),
            success: function (response, textStatus, http) {
                console.log("followed", id)
            },
            error: function (error) {
                console.error(error);
            }
        })
    }

    function addAuthors() {
        console.log("Getting authors");
        $.ajax({
            type: "GET",
            url: "service/authors/page=1&size=3",
            success: function (response, textStatus, http) {
                for (const author in response) {
                    authorBox.appendChild(createAuthorPanel(response[author].displayName, response[author].id));
                }
            },
            error: function (error) {
                console.error(error);
            }
        });
    }

    addAuthors();


</script>