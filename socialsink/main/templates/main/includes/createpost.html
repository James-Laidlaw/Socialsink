{% block content %}
<div class="feed-post create-new">
    <a href="/"><img src="../../../static/images/unknown_user.png" /></a>
    <form class="post-content" onsubmit="submitPost(event)">
        {% csrf_token %}
        <input type="text" id="create-post-text" class="form-control" placeholder="What's happening?" aria-label="What's happening?" name="status">
        <div class="post-btn-wrap">
            <!-- <label for="publicity-items"><i class="fa-solid fa-eye"></i>Publicity</label> -->
            <!-- Make the drop down menu styled like the buttons but clear that it is a drop down for selecting publicity -->
            <div class="select-wrap">
                <select type="button" class="form-select btn" name="publicity-items" id="publicity-drop-down" placeholder="Publicity" aria-label="Public">
                    <option value="public">Public</option>
                    <option value="friends">Friends</option>
                    <option value="private">Private</option>
                </select>
            </div>
            <button type="button" class="btn btn-photo"><i class="fa-solid fa-image"></i>Photo</button>
            <button type="submit" class="btn btn-post"><i class="fa-solid fa-paper-plane"></i>Post</button>
        </div>
    </form>
</div>

<script>

    function submitPost(e) {
        e.preventDefault()

        text = document.getElementById("create-post-text")
        publicity = document.getElementById("publicity-drop-down")

        console.log(text.value)
        console.log(publicity.value)

        var csrf_token = "{{ csrf_token }}";
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrf_token);
                }
            }
        });
        $.ajax({
            type: "POST",
            url: "/api/make-post/",
            contentType: 'application/json',
            data: JSON.stringify({
                'text': text.value,
                'publicity': publicity.value
            }),
            success: function (response, textStatus, http) {
                if (http.status === 201) {
                    text.value = ""
                    publicity.value = ""
                }
            },
            error: function (error) {
                console.error(error);
                // Instead of having the default html alert, maybe have a custom popup thats styled
                // and nice that displays detailed errors and potential fixes (the potential fixes will
                // have to be ironed out by the person who wrote the endpoint / model (RILEY))
                alert("There was an error making your post, please try again")
            }
        })
    }

    function setPublicity() {

    }

</script>
{% endblock content %}